pipelines:
  service1:
    directory: src/service1
    stages:
      - name: unit
        build: test
        run: true
      - name: lint
      - name: candidate
        build: production
        run: false
        publish:
          image: true
    execution:
      - [unit, candidate]
      - [lint, candidate]
  service2:
    directory: src/service2
    stages:
      - name: test
        exports:
          foo: '${setup.timestamp}-${.stage}'
  test-build-options:
    blubberfile: blubber.yaml
    stages:
      - name: test-context-and-excludes
        build:
          variant: service1-checkexcludes
          context: src/service1
          excludes: [Makefile]
